name: ESO_scraper
on:
  schedule:
    # Customize schedule expression at crontab.guru
    # currently running at 9am UTC
    - cron: "0 9 * * *"
  workflow_dispatch:
    #  allow manual updating

jobs:
  scraper:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '17.x'
          check-latest: true
          cache: 'npm'
      - run: npm ci
      - run: npm run build --if-present
      - run: npx playwright install-deps chromium
      - run: ./bin/eso_stats_scraper.js  --headless -o ./src/_data/stats.json
        env:
          ESO_REPORT_USERNAME: ${{ secrets.ESO_REPORT_USERNAME }}
          ESO_REPORT_PASSWORD: ${{ secrets.ESO_REPORT_PASSWORD }}

      - name: Add & Commit updated stats.json
        uses: EndBug/add-and-commit@v7.5.0
        with:
          push: true
          add: ./src/_data/stats.json
